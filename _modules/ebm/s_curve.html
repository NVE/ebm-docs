

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ebm.s_curve &mdash; EBM - Energibruksmodell  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=9ed7352e" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EBM - Energibruksmodell
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../about_the_model.html">About EBM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input_description.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../results.html">Result files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Functionality</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../model_description/index.html">Model Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_parameters/index.html">Building categories and building codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../area/index.html">Area</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../energy_need/index.html">Energy need</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../heating_systems/index.html">Heating systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../energy_use/index.html">Energy use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geographical_distribution/index.html">Geographical distribution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sphinx_guide.html">Sphinx guide - INTERN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EBM - Energibruksmodell</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ebm.s_curve</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ebm.s_curve</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="kn">import</span> <span class="n">Series</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ebm.model.area</span><span class="w"> </span><span class="kn">import</span> <span class="n">building_condition_accumulated_scurves</span><span class="p">,</span> <span class="n">building_condition_scurves</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ebm.model.data_classes</span><span class="w"> </span><span class="kn">import</span> <span class="n">YearRange</span>


<div class="viewcode-block" id="original_condition">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.original_condition">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">original_condition</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">,</span> <span class="n">s_curve_renovation</span><span class="p">,</span>
                       <span class="n">s_curve_renovation_and_small_measure</span><span class="p">,</span> <span class="n">s_curve_small_measure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates buildings remaining as original condition by subtracting every other condition</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_cumulative_demolition : pandas.Series</span>
<span class="sd">    s_curve_renovation : pandas.Series</span>
<span class="sd">    s_curve_renovation_and_small_measure : pandas.Series</span>
<span class="sd">    s_curve_small_measure : pandas.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        buildings remaining as original condition</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span>
            <span class="n">s_curve_cumulative_demolition</span> <span class="o">-</span>
            <span class="n">s_curve_renovation</span> <span class="o">-</span>
            <span class="n">s_curve_renovation_and_small_measure</span> <span class="o">-</span>
            <span class="n">s_curve_small_measure</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;s_curve_original_condition&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="small_measure">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.small_measure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">small_measure</span><span class="p">(</span><span class="n">s_curve_renovation_and_small_measure</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_small_measure_total</span><span class="p">:</span> <span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the remaining small measure share by subtracting renovation and small measure values from</span>
<span class="sd">    the total small measure curve.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_renovation_and_small_measure : Series</span>
<span class="sd">    s_curve_small_measure_total : Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Series</span>
<span class="sd">        s_curve_small_measure</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This function currently does not implement logic to zero out values before the building year.</span>
<span class="sd">    - Assumes both input Series are aligned on the index year.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ### SharesPerCondition calc_small_measure</span>
    <span class="c1">#  - ❌   sett til 0 før byggeår</span>
    <span class="c1"># ```python</span>
    <span class="c1">#     construction_year = self.building_code_params[tek].building_year</span>
    <span class="c1">#     shares.loc[self.period_index &lt;= construction_year] = 0</span>
    <span class="c1"># ```</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">s_curve_small_measure_total</span> <span class="o">-</span> <span class="n">s_curve_renovation_and_small_measure</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;small_measure&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="renovation_and_small_measure">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.renovation_and_small_measure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">renovation_and_small_measure</span><span class="p">(</span><span class="n">s_curve_renovation</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_renovation_total</span><span class="p">:</span> <span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the remaining renovation_and_small_measure share by subtracting renovation</span>
<span class="sd">    from the total renovation total curve.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_renovation : pandas.Series</span>
<span class="sd">        A time series representing the S-curve of exclusive renovation condition.</span>

<span class="sd">    s_curve_renovation_total : pandas.Series</span>
<span class="sd">        A time series representing the total S-curve for the total renovation condition.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        A time series representing the difference between the total and renovation-only S-curves.</span>
<span class="sd">        Values before the building year should be set to 0 (not yet implemented).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This function currently does not implement logic to zero out values before the building year.</span>
<span class="sd">    - Assumes both input Series are aligned on index year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ### SharesPerCondition calc_renovation_and_small_measure</span>
    <span class="c1">#  - ❌ Sett til 0 før byggeår</span>

    <span class="k">return</span> <span class="n">s_curve_renovation_total</span> <span class="o">-</span> <span class="n">s_curve_renovation</span></div>



<div class="viewcode-block" id="trim_renovation_from_renovation_total">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.trim_renovation_from_renovation_total">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trim_renovation_from_renovation_total</span><span class="p">(</span><span class="n">s_curve_renovation</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span>
                                          <span class="n">s_curve_renovation_max</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span>
                                          <span class="n">s_curve_renovation_total</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span>
                                          <span class="n">scurve_total</span><span class="p">:</span> <span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjust the renovation S-curve by incorporating values from the total renovation curve</span>
<span class="sd">    where the total share is less than the maximum renovation share.</span>

<span class="sd">    This function identifies time points where the total S-curve (`scurve_total`) is less than</span>
<span class="sd">    the maximum renovation S-curve (`s_curve_renovation_max`). For those points, it replaces</span>
<span class="sd">    the corresponding values in `s_curve_renovation` with values from `s_curve_renovation_total`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_renovation : pandas.Series</span>
<span class="sd">        The original renovation S-curve to be adjusted.</span>

<span class="sd">    s_curve_renovation_max : pandas.Series</span>
<span class="sd">        The maximum allowed values for the renovation S-curve.</span>

<span class="sd">    s_curve_renovation_total : pandas.Series</span>
<span class="sd">        The total renovation S-curve including all measures.</span>

<span class="sd">    scurve_total : pandas.Series</span>
<span class="sd">        The actual total S-curve values to compare against the max renovation curve.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        The adjusted renovation S-curve with values merged from the total renovation curve</span>
<span class="sd">        where the total share is less than the maximum renovation share.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Assumes all input Series are aligned on the index year.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">adjusted_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">scurve_total</span> <span class="o">&lt;</span> <span class="n">s_curve_renovation_max</span><span class="p">,</span>
                               <span class="n">s_curve_renovation_total</span><span class="p">,</span>
                               <span class="n">s_curve_renovation</span><span class="p">)</span>
    <span class="n">trimmed_renovation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">adjusted_values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">s_curve_renovation</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;renovation&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trimmed_renovation</span></div>



<div class="viewcode-block" id="renovation_from_small_measure">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.renovation_from_small_measure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">renovation_from_small_measure</span><span class="p">(</span><span class="n">s_curve_renovation_max</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_small_measure_total</span><span class="p">:</span> <span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the renovation S-curve by subtracting small measures from the max renovation curve.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_renovation_max : pandas.Series</span>
<span class="sd">        The maximum yearly values for the renovation S-curve.</span>

<span class="sd">    s_curve_small_measure_total : pandas.Series</span>
<span class="sd">        The yearly total S-curve for small measures.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        The resulting renovation S-curve with values clipped at 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ## small_measure and renovation to scurve_small_measure_total, RN</span>
    <span class="c1"># ## SharesPerCondition calc_renovation</span>
    <span class="c1">#</span>
    <span class="c1">#  - ❌ Ser ut som det er edge case for byggeår.</span>
    <span class="c1">#  - ❌ Årene før byggeår må settes til 0 for scurve_renovation?</span>
    <span class="n">s_curve_renovation</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_curve_renovation_max</span> <span class="o">-</span> <span class="n">s_curve_small_measure_total</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s_curve_renovation</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;s_curve_renovation&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="total">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.total">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">total</span><span class="p">(</span><span class="n">s_curve_renovation_total</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_small_measure_total</span><span class="p">:</span> <span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the yearly sum of renovation and small_measure</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_renovation_total : pandas.Series</span>
<span class="sd">    s_curve_small_measure_total : pandas.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        yearly sum of renovation and small_measure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">s_curve_small_measure_total</span> <span class="o">+</span> <span class="n">s_curve_renovation_total</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;s_curve_total&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="trim_max_value">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.trim_max_value">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trim_max_value</span><span class="p">(</span><span class="n">s_curve_cumulative_small_measure</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_small_measure_max</span><span class="p">:</span> <span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span><span class="n">Series</span><span class="p">:</span>
    <span class="n">s_curve_cumulative_small_measure_max</span> <span class="o">=</span> <span class="n">s_curve_cumulative_small_measure</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">s_curve_small_measure_max</span><span class="p">,</span> <span class="nb">min</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s_curve_cumulative_small_measure_max</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># type: ignore</span></div>



<div class="viewcode-block" id="small_measure_max">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.small_measure_max">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">small_measure_max</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_small_measure_never_share</span><span class="p">:</span> <span class="n">Series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the maximum possible value for small_measure condition</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_cumulative_demolition : pandas.Series</span>
<span class="sd">    s_curve_small_measure_never_share : pandas.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        Yearly maximum possible value for small_measure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s_curve_cumulative_demolition</span> <span class="o">-</span> <span class="n">s_curve_small_measure_never_share</span></div>



<div class="viewcode-block" id="renovation_max">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.renovation_max">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">renovation_max</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_renovation_never_share</span><span class="p">:</span> <span class="n">Series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the maximum possible value for renovation condition</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_cumulative_demolition : pandas.Series</span>
<span class="sd">    s_curve_renovation_never_share : pandas.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        Yearly maximum possible value for renovation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s_curve_cumulative_demolition</span> <span class="o">-</span> <span class="n">s_curve_renovation_never_share</span></div>



<div class="viewcode-block" id="cumulative_renovation">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.cumulative_renovation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cumulative_renovation</span><span class="p">(</span><span class="n">s_curves_with_building_code</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="n">YearRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the  yearly cumulative sum of renovation condition.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curves_with_building_code : pandas.Series</span>
<span class="sd">    years : pandas.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        cumulative sum of renovation</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    NaN values are replaced by float 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">s_curves_with_building_code</span><span class="o">.</span><span class="n">renovation_acc</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">years</span><span class="o">.</span><span class="n">year_range</span><span class="p">))]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="cumulative_small_measure">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.cumulative_small_measure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cumulative_small_measure</span><span class="p">(</span><span class="n">s_curves_with_building_code</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="n">YearRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the  yearly cumulative sum of small_measure condition.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curves_with_building_code : pandas.Series</span>
<span class="sd">    years : YearRange</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        cumulative sum of small_measure</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    NaN values are replaced by float 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s_curve_cumulative_small_measure</span> <span class="o">=</span> <span class="n">s_curves_with_building_code</span><span class="o">.</span><span class="n">small_measure_acc</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">years</span><span class="o">.</span><span class="n">year_range</span><span class="p">))]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s_curve_cumulative_small_measure</span></div>



<div class="viewcode-block" id="transform_demolition">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.transform_demolition">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transform_demolition</span><span class="p">(</span><span class="n">demolition</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="n">YearRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter yearly demolition for years</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    demolition : pandas.Series</span>
<span class="sd">    years : YearRange</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    demolition for years</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">demolition</span><span class="o">.</span><span class="n">demolition</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">years</span><span class="o">.</span><span class="n">year_range</span><span class="p">))]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span></div>



<div class="viewcode-block" id="transform_to_cumulative_demolition">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.transform_to_cumulative_demolition">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transform_to_cumulative_demolition</span><span class="p">(</span><span class="n">cumulative_demolition</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span><span class="n">YearRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter yearly cumulative demolition for years</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cumulative_demolition : pandas.DataFrame</span>
<span class="sd">    years : YearRange</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        cumulative demolition for years</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s_curve_cumulative_demolition</span> <span class="o">=</span> <span class="n">cumulative_demolition</span><span class="o">.</span><span class="n">demolition_acc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">years</span><span class="o">.</span><span class="n">year_range</span><span class="p">))]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s_curve_cumulative_demolition</span></div>



<div class="viewcode-block" id="scurve_parameters_to_never_share">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.scurve_parameters_to_never_share">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">scurve_parameters_to_never_share</span><span class="p">(</span><span class="n">s_curves</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">scurve_parameters</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform scurve_parameters with s_curve to never_share.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curves : pandas.DataFrame</span>
<span class="sd">    scurve_parameters : pandas.DataFrame</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Age is padded from -max age to 0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_age</span> <span class="o">=</span> <span class="n">s_curves</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">df_never_share</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="c1"># noinspection PyTypeChecker</span>
        <span class="p">[(</span><span class="n">row</span><span class="o">.</span><span class="n">building_category</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">condition</span> <span class="o">+</span> <span class="s1">&#39;_never_share&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">never_share</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">max_age</span><span class="p">,</span> <span class="n">max_age</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span>
         <span class="n">scurve_parameters</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()],</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;building_condition&#39;</span><span class="p">,</span> <span class="s1">&#39;scurve&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">,</span> <span class="s1">&#39;building_condition&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;building_condition&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df_never_share</span></div>



<div class="viewcode-block" id="scurve_parameters_to_scurve">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.scurve_parameters_to_scurve">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">scurve_parameters_to_scurve</span><span class="p">(</span><span class="n">scurve_parameters</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create scurve new dataframe from scurve_parameters using ebm.model.area.building_condition_scurves and</span>
<span class="sd">        ebm.model.area.building_condition_accumulated_scurves</span>

<span class="sd">    Each row represent a building_category and building_condition at a certain age.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scurve_parameters : pandas.DataFrame</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scurve_by_year</span> <span class="o">=</span> <span class="n">building_condition_scurves</span><span class="p">(</span><span class="n">scurve_parameters</span><span class="p">)</span>
    <span class="n">scurve_accumulated</span> <span class="o">=</span> <span class="n">building_condition_accumulated_scurves</span><span class="p">(</span><span class="n">scurve_parameters</span><span class="p">)</span>
    <span class="n">s_curves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">scurve_by_year</span><span class="p">,</span> <span class="n">scurve_accumulated</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">s_curves</span></div>



<div class="viewcode-block" id="accumulate_demolition">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.accumulate_demolition">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">accumulate_demolition</span><span class="p">(</span><span class="n">s_curves_long</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="n">YearRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets demolition in year 0 (2020) to 0.0 and sums up the yearly demolition using years</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curves_long : pandas.DataFrame</span>
<span class="sd">    years : YearRange</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">demolition_acc</span> <span class="o">=</span> <span class="n">s_curves_long</span>
    <span class="n">demolition_acc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">demolition_acc</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;year&lt;=</span><span class="si">{</span><span class="n">years</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;demolition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">demolition_acc</span><span class="p">[</span><span class="s1">&#39;demolition_acc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demolition_acc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">,</span> <span class="s1">&#39;building_code&#39;</span><span class="p">])[[</span><span class="s1">&#39;demolition&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()[</span>
        <span class="p">[</span><span class="s1">&#39;demolition&#39;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">demolition_acc</span></div>


<span class="c1"># noinspection PyTypeChecker</span>
<div class="viewcode-block" id="merge_s_curves_and_building_code">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.merge_s_curves_and_building_code">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_s_curves_and_building_code</span><span class="p">(</span><span class="n">s_curves</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">df_never_share</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">building_code_parameters</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cross merge s_curves and df_never_share with all building_code in building_code_parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curves : pandas.DataFrame</span>
<span class="sd">    df_never_share : pandas.DataFrame</span>
<span class="sd">    building_code_parameters : pandas.DataFrame</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s_curves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s_curves</span><span class="p">,</span> <span class="n">df_never_share</span><span class="p">])</span>

    <span class="n">s_curves_by_building_code</span> <span class="o">=</span> <span class="n">s_curves</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">building_code_parameters</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">)</span>
    <span class="n">s_curves_by_building_code</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curves_by_building_code</span><span class="p">[</span><span class="s1">&#39;building_year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">s_curves_by_building_code</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>
    <span class="n">s_curves_long</span> <span class="o">=</span> <span class="n">s_curves_by_building_code</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">,</span> <span class="s1">&#39;building_code&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span>
                                          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;building_condition&#39;</span><span class="p">],</span>
                                          <span class="n">values</span><span class="o">=</span><span class="s1">&#39;scurve&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">s_curves_long</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_curves_long</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;building_category&#39;</span><span class="p">,</span> <span class="s1">&#39;building_code&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">s_curves_long</span></div>



<div class="viewcode-block" id="transform_to_dataframe">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.transform_to_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transform_to_dataframe</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_original_condition</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_renovation</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span>
                           <span class="n">s_curve_renovation_and_small_measure</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_small_measure</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">s_curve_demolition</span><span class="p">:</span> <span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a pandas DataFrame from the parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curve_cumulative_demolition : pandas.Series</span>
<span class="sd">    s_curve_original_condition : pandas.Series</span>
<span class="sd">    s_curve_renovation : pandas.Series</span>
<span class="sd">    s_curve_renovation_and_small_measure : pandas.Series</span>
<span class="sd">    s_curve_small_measure : pandas.Series</span>
<span class="sd">    s_curve_demolition : pandas.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s_curves_by_condition</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;original_condition&#39;</span><span class="p">:</span> <span class="n">s_curve_original_condition</span><span class="p">,</span>
        <span class="s1">&#39;demolition&#39;</span><span class="p">:</span> <span class="n">s_curve_cumulative_demolition</span><span class="p">,</span>
        <span class="s1">&#39;small_measure&#39;</span><span class="p">:</span> <span class="n">s_curve_small_measure</span><span class="p">,</span>
        <span class="s1">&#39;renovation&#39;</span><span class="p">:</span> <span class="n">s_curve_renovation</span><span class="p">,</span>
        <span class="s1">&#39;renovation_and_small_measure&#39;</span><span class="p">:</span> <span class="n">s_curve_renovation_and_small_measure</span><span class="p">,</span>
        <span class="s1">&#39;s_curve_demolition&#39;</span><span class="p">:</span> <span class="n">s_curve_demolition</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">s_curves_by_condition</span></div>



<div class="viewcode-block" id="transform_to_long">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.transform_to_long">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transform_to_long</span><span class="p">(</span><span class="n">s_curves_by_condition</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_curves_by_condition : pandas.DataFrame </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        transformed to long, on condition for each row</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_long</span> <span class="o">=</span> <span class="n">s_curves_by_condition</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;s_curve&#39;</span><span class="p">)</span>

    <span class="n">df_long</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">,</span> <span class="s1">&#39;building_code&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;building_condition&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df_long</span></div>



<div class="viewcode-block" id="calculate_s_curves">
<a class="viewcode-back" href="../../modules/ebm.s_curve.html#ebm.s_curve.calculate_s_curves">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_s_curves</span><span class="p">(</span><span class="n">scurve_parameters</span><span class="p">,</span> <span class="n">building_code_parameters</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Transform s_curve_parameters into long form with each row representing a building_condition at a certain age</span>
    <span class="n">s_curves</span> <span class="o">=</span> <span class="n">scurve_parameters_to_scurve</span><span class="p">(</span><span class="n">scurve_parameters</span><span class="p">)</span>
    <span class="n">df_never_share</span> <span class="o">=</span> <span class="n">scurve_parameters_to_never_share</span><span class="p">(</span><span class="n">s_curves</span><span class="p">,</span> <span class="n">scurve_parameters</span><span class="p">)</span>

    <span class="n">s_curves_with_building_code</span> <span class="o">=</span> <span class="n">merge_s_curves_and_building_code</span><span class="p">(</span><span class="n">s_curves</span><span class="p">,</span> <span class="n">df_never_share</span><span class="p">,</span> <span class="n">building_code_parameters</span><span class="p">)</span>
    <span class="n">s_curves_with_building_code</span> <span class="o">=</span> <span class="n">s_curves_with_building_code</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">years</span><span class="p">])]</span>

    <span class="n">s_curves_with_demolition_acc</span> <span class="o">=</span> <span class="n">accumulate_demolition</span><span class="p">(</span><span class="n">s_curves_with_building_code</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>
    <span class="n">s_curve_demolition</span> <span class="o">=</span> <span class="n">s_curves_with_building_code</span><span class="o">.</span><span class="n">demolition</span>

    <span class="n">s_curve_cumulative_demolition</span> <span class="o">=</span> <span class="n">transform_to_cumulative_demolition</span><span class="p">(</span><span class="n">s_curves_with_demolition_acc</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>
    <span class="n">s_curve_renovation_never_share</span> <span class="o">=</span> <span class="n">s_curves_with_building_code</span><span class="o">.</span><span class="n">renovation_never_share</span>
    <span class="n">s_curve_small_measure_never_share</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;small_measure_never_share&#39;</span><span class="p">,</span> <span class="n">s_curves_with_building_code</span><span class="o">.</span><span class="n">small_measure_never_share</span><span class="p">)</span>
    <span class="n">s_curve_cumulative_small_measure</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cumulative_small_measure&#39;</span><span class="p">,</span> <span class="n">cumulative_small_measure</span><span class="p">(</span><span class="n">s_curves_with_building_code</span><span class="p">,</span> <span class="n">years</span><span class="p">))</span>
    <span class="n">s_curve_cumulative_renovation</span> <span class="o">=</span> <span class="n">cumulative_renovation</span><span class="p">(</span><span class="n">s_curves_with_building_code</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>

    <span class="n">s_curve_renovation_max</span> <span class="o">=</span> <span class="n">renovation_max</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">,</span> <span class="n">s_curve_renovation_never_share</span><span class="p">)</span>
    <span class="n">s_curve_small_measure_max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;s_curve_small_measure_max&#39;</span><span class="p">,</span> <span class="n">small_measure_max</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">,</span> <span class="n">s_curve_small_measure_never_share</span><span class="p">))</span>


    <span class="n">s_curve_small_measure_total</span> <span class="o">=</span> <span class="n">trim_max_value</span><span class="p">(</span><span class="n">s_curve_cumulative_small_measure</span><span class="p">,</span> <span class="n">s_curve_small_measure_max</span><span class="p">)</span>
    <span class="n">s_curve_renovation_total</span> <span class="o">=</span> <span class="n">trim_max_value</span><span class="p">(</span><span class="n">s_curve_cumulative_renovation</span><span class="p">,</span> <span class="n">s_curve_renovation_max</span><span class="p">)</span>
    <span class="n">scurve_total</span> <span class="o">=</span> <span class="n">total</span><span class="p">(</span><span class="n">s_curve_renovation_total</span><span class="p">,</span> <span class="n">s_curve_small_measure_total</span><span class="p">)</span>

    <span class="n">s_curve_renovation_from_small_measure</span> <span class="o">=</span> <span class="n">renovation_from_small_measure</span><span class="p">(</span><span class="n">s_curve_renovation_max</span><span class="p">,</span> <span class="n">s_curve_small_measure_total</span><span class="p">)</span>
    <span class="n">s_curve_renovation</span> <span class="o">=</span> <span class="n">trim_renovation_from_renovation_total</span><span class="p">(</span><span class="n">s_curve_renovation</span><span class="o">=</span><span class="n">s_curve_renovation_from_small_measure</span><span class="p">,</span>
                                                               <span class="n">s_curve_renovation_max</span><span class="o">=</span><span class="n">s_curve_renovation_max</span><span class="p">,</span>
                                                               <span class="n">s_curve_renovation_total</span><span class="o">=</span><span class="n">s_curve_renovation_total</span><span class="p">,</span>
                                                               <span class="n">scurve_total</span><span class="o">=</span><span class="n">scurve_total</span><span class="p">)</span>

    <span class="n">s_curve_renovation_and_small_measure</span> <span class="o">=</span> <span class="n">renovation_and_small_measure</span><span class="p">(</span><span class="n">s_curve_renovation</span><span class="p">,</span> <span class="n">s_curve_renovation_total</span><span class="p">)</span>

    <span class="n">s_curve_small_measure</span> <span class="o">=</span> <span class="n">small_measure</span><span class="p">(</span><span class="n">s_curve_renovation_and_small_measure</span><span class="p">,</span> <span class="n">s_curve_small_measure_total</span><span class="p">)</span>

    <span class="n">s_curve_original_condition</span> <span class="o">=</span> <span class="n">original_condition</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">,</span> <span class="n">s_curve_renovation</span><span class="p">,</span>
                                                            <span class="n">s_curve_renovation_and_small_measure</span><span class="p">,</span>
                                                            <span class="n">s_curve_small_measure</span><span class="p">)</span>

    <span class="n">s_curves_by_condition</span> <span class="o">=</span> <span class="n">transform_to_dataframe</span><span class="p">(</span><span class="n">s_curve_cumulative_demolition</span><span class="p">,</span>
                                                           <span class="n">s_curve_original_condition</span><span class="p">,</span>
                                                           <span class="n">s_curve_renovation</span><span class="p">,</span>
                                                           <span class="n">s_curve_renovation_and_small_measure</span><span class="p">,</span>
                                                           <span class="n">s_curve_small_measure</span><span class="p">,</span>
                                                           <span class="n">s_curve_demolition</span><span class="p">)</span>

    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;original_condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_original_condition</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;demolition&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_cumulative_demolition</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;small_measure&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_small_measure</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;renovation&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_renovation</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;renovation_and_small_measure&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_renovation_and_small_measure</span>

    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_sum&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_original_condition</span> <span class="o">+</span> <span class="n">s_curve_cumulative_demolition</span> <span class="o">+</span> <span class="n">s_curve_small_measure</span> <span class="o">+</span> <span class="n">s_curve_renovation</span> <span class="o">+</span> <span class="n">s_curve_renovation_and_small_measure</span>

    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_demolition&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_demolition</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_cumulative_demolition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_cumulative_demolition</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_small_measure_total&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_small_measure_total</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_small_measure_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_small_measure_max</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_cumulative_small_measure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_cumulative_small_measure</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_small_measure_never_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_small_measure_never_share</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;scurve_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scurve_total</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_renovation_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_renovation_max</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_cumulative_renovation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_cumulative_renovation</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;s_curve_renovation_total&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">s_curve_renovation_total</span>
    <span class="n">s_curves_by_condition</span><span class="p">[</span><span class="s1">&#39;renovation_never_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_curve_renovation_never_share</span>


    <span class="k">return</span> <span class="n">s_curves_by_condition</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The Norwegian Water Resources and Energy Directorate (NVE).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>